var SV=window.SV||{};SV.AdvancedBBCode=SV.AdvancedBBCode||{};SV.AdvancedBBCode.EditorButtons=SV.AdvancedBBCode.EditorButtons||{};SV.WordCounter=SV.WordCounter||{};SV.$=SV.$||window.jQuery||null;
(function(h,d,e){let f=((e=SV.$)?e.FE:null)||h.FroalaEditor;SV.AdvancedBBCode.EditorConfig=[];SV.AdvancedBBCode.EditorFirstStart=[];SV.AdvancedBBCode.EditorInit=[];SV.AdvancedBBCode.editorConfig={dialog:[],tags:{abbr:!1,h4:!1,fa:{}},wordCounter:!1,shimH1:!1,shimHr:!1,pasteQuotesAsBbCode:!1,normalizeQuoteChars:!1,hrStyle:0,disableBbCodeModeClicks:0,disableDisableBbCodeModeClicks:0,disableBbCodeModeClicksPhrase:""};SV.AdvancedBBCode.EditorButtons.config=function(b,a,c){a=a||b.config;c=c||b.editor;(SV.AdvancedBBCode.editorConfig.tags||
{}).abbr&&a.htmlAllowedTags.push("abbr");for(let g in SV.AdvancedBBCode.EditorConfig)(0,SV.AdvancedBBCode.EditorConfig[g])(SV.AdvancedBBCode.editorConfig,a,c,f)};SV.AdvancedBBCode.EditorButtons.editorInit=function(b,a,c){a=a||b.ed;c=c||b.editor;for(let g in SV.AdvancedBBCode.EditorInit)(0,SV.AdvancedBBCode.EditorInit[g])(SV.AdvancedBBCode.editorConfig,a,c,f)};SV.AdvancedBBCode.EditorButtons.setupConfig=function(b){try{SV.AdvancedBBCode.editorConfig=JSON.parse(b.innerHTML)||{}}catch(a){console.error(a)}};
SV.AdvancedBBCode.EditorButtons.setupLanguage=function(){let b,a=d.querySelector(".js-editorLanguage-ex");if(a){try{b=JSON.parse(a.innerHTML)||{}}catch(c){console.error(c),b={}}for(let c in b)f.LANGUAGE.xf[c]=b[c]}};SV.AdvancedBBCode.EditorButtons.init=function(){let b=d.querySelector(".js-editorConfig-ex");if(b){var a=SV.AdvancedBBCode.EditorButtons;a.setupConfig(b);a.setupLanguage();for(let c in SV.AdvancedBBCode.EditorFirstStart)(0,SV.AdvancedBBCode.EditorFirstStart[c])(SV.AdvancedBBCode.editorConfig,
f)}else console.log("Failed extend editor.")};"function"!==typeof XF.on?(e(d).on("editor:config",SV.AdvancedBBCode.EditorButtons.config.bind(this)),e(d).on("editor:first-start",SV.AdvancedBBCode.EditorButtons.init.bind(this)),e(d).on("editor:init",SV.AdvancedBBCode.EditorButtons.editorInit.bind(this))):(XF.on(d,"editor:config",SV.AdvancedBBCode.EditorButtons.config.bind(this)),XF.on(d,"editor:first-start",SV.AdvancedBBCode.EditorButtons.init.bind(this)),XF.on(d,"editor:init",SV.AdvancedBBCode.EditorButtons.editorInit.bind(this)))})(window,
document);


var SV=window.SV||{};SV.AdvancedBBCode=SV.AdvancedBBCode||{};SV.AdvancedBBCode.EditorButtons=SV.AdvancedBBCode.EditorButtons||{};SV.AdvancedBBCode.EditorFirstStart=SV.AdvancedBBCode.EditorFirstStart||[];
(function(){SV.AdvancedBBCode.EditorButtons.setupShimQuote=function(b,a){a.callback=function(){this.selection.save();this.undo.saveStep();const c=this.html.getSelected();this.html.insert("<p>[QUOTE]</p>"+c+"<p>[/QUOTE]</p><p><br></p>");this.selection.restore();this.placeholder.hide();this.undo.saveStep();XF.EditorHelpers.normalizeAfterInsert(this)}};SV.AdvancedBBCode.EditorFirstStart.push(function(b,a){a.COMMANDS.xfQuote&&b.pasteQuotesAsBbCode&&SV.AdvancedBBCode.EditorButtons.setupShimQuote(a,a.COMMANDS.xfQuote)}.bind(this))})();


var SV=window.SV||{};SV.AdvancedBBCode=SV.AdvancedBBCode||{};SV.AdvancedBBCode.EditorButtons=SV.AdvancedBBCode.EditorButtons||{};SV.AdvancedBBCode.EditorFirstStart=SV.AdvancedBBCode.EditorFirstStart||[];SV.$=SV.$||window.jQuery||null;
(function(){const m=SV.$;SV.AdvancedBBCode.EditorButtons.shimToggleBbCode=function(r){const g="undefined"===typeof XF.on;r.PLUGINS.bbCode=function(a){function n(){return a.$tb.find(".fr-command[data-cmd=xfBbCode]")[0]}function k(){const c=a.$oel;let b=c.data("xfBbCodeBox");if(!b){const f=parseInt(a.$wp.css("border-bottom-width"),10)+parseInt(a.$wp.css("border-top-width"),10);let e;g?(e=m('<textarea class="input" style="display: none" />'),b=e[0]):b=XF.createElementFromString('<textarea class="input" style="display: none"></textarea>');
b.setAttribute("aria-label",XF.htmlspecialchars(XF.phrase("rich_text_box")));Object.assign(b.style,{minHeight:a.opts.heightMin?a.opts.heightMin+f+"px":null,maxHeight:a.opts.heightMax?a.opts.heightMax+"px":null,height:a.opts.height?a.opts.height+f+"px":null,padding:a.$el.css("padding")});b.setAttribute("name",c.data("original-name"));c.data("xfBbCodeBox",b);a.$wp.after(b);let d;g?(d=e,e.on("focus blur",function(l){switch(l.type){case "focus":a.$box.addClass("is-focused");break;case "blur":a.$box.removeClass("is-focused")}})):
(d=b,XF.on(b,"focus",l=>a.$box.addClass("is-focused")),XF.on(b,"blur",l=>a.$box.removeClass("is-focused")));setTimeout(()=>{XF.Element.applyHandler(d,"textarea-handler");XF.Element.applyHandler(d,"user-mentioner");XF.Element.applyHandler(d,"emoji-completer");XF.isElementWithinDraftForm(d)&&XF.Element.applyHandler(d,"draft-trigger")},100)}return b}function p(c){return Array.from(a.$tb[0].querySelectorAll(".fr-btn-grp .fr-command, .fr-more-toolbar .fr-command")).filter(b=>!b.isSameNode(c)&&!b.getAttribute("data-cmd").startsWith("more")&&
"xfPreview"!==b.getAttribute("data-cmd")&&"fullscreen"!==b.getAttribute("data-cmd")&&"xfDraft"!==b.getAttribute("data-cmd"))}function t(c,b){const f=k(),e=function(d,l){h=!0;let q;a.undo.saveStep();a.$el.blur();q=n();p(q).forEach(x=>x.classList.add("fr-disabled"));q.classList.add("fr-active");a.$wp.css("display","none");a.$oel.attr("disabled","disabled");g?m(f).val(d).css("display","").prop("disabled",!1).trigger("autosize"):(f.value=d,XF.display(f),f.disabled=!1,XF.trigger(f,"autosize"));l||f.focus();
XF.setIsEditorEnabled(!1)};"string"==typeof c?e(c,b):XF.ajax("POST",XF.canonicalizeUrl("index.php?editor/to-bb-code"),{html:a.html.get()},function(d){e(d.bbCode,b)})}function u(c){const b=k(),f=function(e){h=!1;const d=n();p(d).forEach(l=>l.classList.remove("fr-disabled"));d.classList.remove("fr-active");a.$oel.removeAttr("disabled");a.html.set(e);g?m(b).css("display","none").prop("disabled",!0):(XF.display(b,"none"),b.disabled=!0);a.$wp.css("display","");a.events.focus();a.undo.saveStep();a.size.refresh();
XF.setIsEditorEnabled(!0);XF.layoutChange()};if("string"==typeof c)f(c);else{c={bb_code:b.value};const e=a.$el[0].closest("form");e&&e[a.opts.xfBbCodeAttachmentContextInput]&&(c.attachment_hash_combined=e[a.opts.xfBbCodeAttachmentContextInput].value);XF.ajax("POST",XF.canonicalizeUrl("index.php?editor/to-html"),c,function(d){f(d.editorHtml)})}}function v(){return p(n())}function w(){return h?k():null}let h=!1;return{_init:function(){a.events.on("buttons.refresh",function(){return!h})},getBbCodeBox:g?
()=>m(k()):k,toBbCode:t,isBbCodeView:function(){return h},getTextArea:g?()=>m(w()):w,insertBbCode:function(c){if(h){var b=k();XF.insertIntoTextBox(b,c)}},replaceBbCode:function(c){if(h){var b=k();XF.replaceIntoTextBox(b,c)}},toHtml:u,toggle:function(){h?u():t()},getToggleableButtons:g?()=>m(v()):v}}};SV.AdvancedBBCode.EditorConfig.push(function(r,g,a,n){n.PLUGINS.bbCode&&SV.AdvancedBBCode.EditorButtons.shimToggleBbCode(n)}.bind(this))})();


var SV=window.SV||{};SV.AdvancedBBCode=SV.AdvancedBBCode||{};SV.AdvancedBBCode.EditorButtons=SV.AdvancedBBCode.EditorButtons||{};SV.AdvancedBBCode.EditorFirstStart=SV.AdvancedBBCode.EditorFirstStart||[];SV.$=SV.$||window.jQuery||null;
(function(n,p,r){const f=SV.$;XF.Editor=XF.extend(XF.Editor,{__backup:{editorInit:"svAdvancedBbCode_fullscreen_editorInit"},editorInit:function(){this.svAdvancedBbCode_fullscreen_editorInit();this.ed.events.on("commands.before",function(b){"fullscreen"===b&&setTimeout(()=>n.dispatchEvent(new Event("resize")),0)})}});SV.AdvancedBBCode.EditorButtons.shimToggleFullscreen=function(b){const d=b.PLUGINS.fullscreen,g="undefined"===typeof XF.on;b.PLUGINS.fullscreen=function(h){const e=d(h),q=e.toggle;e.toggle=
function(){const k=q();var a=h.$box.get(0);if(!a||e.isActive())return k;const c=a.closest(".message-editorWrapper");c&&(XF.focusEditor(g?f(c):c),p.querySelector(".p-navSticky")&&setTimeout(function(){XF.focusEditor(g?f(c):c)},0));if(a=a.querySelector("textarea.input")){const l=a.dataset.minHeight,m=a.dataset.maxHeight;l&&m&&(a.style.minHeight=l,a.style.maxHeight=m,delete a.dataset.minHeight,delete a.dataset.maxHeight,a.value=a.value)}return k};return e}};SV.AdvancedBBCode.EditorFirstStart.push(function(b,
d){d.PLUGINS.fullscreen&&SV.AdvancedBBCode.EditorButtons.shimToggleFullscreen(d)}.bind(this))})(window,document);


var SV=window.SV||{};SV.AdvancedBBCode=SV.AdvancedBBCode||{};SV.AdvancedBBCode.EditorButtons=SV.AdvancedBBCode.EditorButtons||{};SV.AdvancedBBCode.EditorFirstStart=SV.AdvancedBBCode.EditorFirstStart||[];
(function(){SV.AdvancedBBCode.EditorButtons.setupShimParagraphStyle=function(b,a){const c=a.callback;a.callback=function(d,e){c.apply(this,[d,e]);this.$el.find("h1:not(.bbc-header),h2:not(.bbc-header),h3:not(.bbc-header),h4:not(.bbc-header)").addClass("bbc-header");this.$el.find("p.bbc-header, span.bbc-header, div.bbc-header").removeClass("bbc-header")}};SV.AdvancedBBCode.EditorFirstStart.push(function(b,a){b.shimH1&&(a.BLOCK_TAGS.push("svbbcode_h1"),a.BLOCK_TAGS.push("svbbcode_h2"),a.BLOCK_TAGS.push("svbbcode_h3"),
a.BLOCK_TAGS.push("svbbcode_h4"),a.COMMANDS.paragraphFormat&&SV.AdvancedBBCode.EditorButtons.setupShimParagraphStyle(a,a.COMMANDS.paragraphFormat))}.bind(this));SV.AdvancedBBCode.EditorConfig.push(function(b,a,c,d){b.shimH1&&(a.paragraphFormat={N:"Normal",H1:"Heading 1",H2:"Heading 2",H3:"Heading 3"},(SV.AdvancedBBCode.editorConfig.tags||{}).h4&&(a.paragraphFormat.H4="Heading 4"))}.bind(this))})();


var SV=window.SV||{};SV.AdvancedBBCode=SV.AdvancedBBCode||{};SV.AdvancedBBCode.EditorButtons=SV.AdvancedBBCode.EditorButtons||{};SV.AdvancedBBCode.EditorFirstStart=SV.AdvancedBBCode.EditorFirstStart||[];(function(){SV.AdvancedBBCode.EditorButtons.setupShimInsertHr=function(b,a){b.COMMANDS.xfCustom_hr&&(a.callback=b.COMMANDS.xfCustom_hr.callback)};SV.AdvancedBBCode.EditorFirstStart.push(function(b,a){a.COMMANDS.insertHR&&b.shimHr&&SV.AdvancedBBCode.EditorButtons.setupShimInsertHr(a,a.COMMANDS.insertHR)}.bind(this))})();


var SV=window.SV||{};SV.AdvancedBBCode=SV.AdvancedBBCode||{};SV.$=SV.$||window.jQuery||null;
(function(g,h,k){const e=SV.$;XF.Element.extend("textarea-handler",{__backup:{init:"svAdvancedBbCode_disableClicker_init"},svEditor:null,setupDisableClickerWatcher:function(d,b,c){let a=d.ed,f=!0;a.svDisabledClicks=0;a.svDisabledClicksAttempts=0;a.$tb.on("click","button.fr-disabled",function(){f&&a.bbCode.isBbCodeView()&&(a.svDisabledClicks+=1,a.svDisabledClicks>=b&&(a.svDisabledClicks=0,confirm(XF.phrase("svAdvancedBbCodesPack_bbcode_mode_button_usage"))?a.bbCode.toggle():(a.svDisabledClicksAttempts+=
1,a.svDisabledClicksAttempts>=c&&(f=!1))))}.bind(this))},init:function(){this.svAdvancedBbCode_disableClicker_init();var d="undefined"===typeof XF.on;if(!this.svEditor){var b=this.target||this.$target.get(0),c=b.closest(".message-editorWrapper");c&&(this.svEditor=XF.getEditorInContainer(d?e(c):c));this.svEditor||(this.svEditor=(b=(b=b.closest(".bbWrapper"))?b.parentNode:null)?XF.getEditorInContainer(d?e(b):b):null);if(!this.svEditor)return}d=SV.AdvancedBBCode.editorConfig.disableBbCodeModeClicks|
0;b=SV.AdvancedBBCode.editorConfig.disableDisableBbCodeModeClicks|0;c=SV.AdvancedBBCode.editorConfig.disableBbCodeModeClicksPhrase||"";0<d&&c&&(XF.phrases.svAdvancedBbCodesPack_bbcode_mode_button_usage=c,this.setupDisableClickerWatcher(this.svEditor,d,b))}})})(window,document);


/*
 froala_editor v2.8.5 (https://www.froala.com/wysiwyg-editor)
 License https://froala.com/wysiwyg-editor/terms/
 Copyright 2014-2018 Froala Labs
*/
(function(){const p={wordCounter:!1,wordCounterLabel:"words",wordCounterLabels:null,wordCounterBbCode:!1,wordCounterTimeout:0,wordCounterGetText:null};let q=(window.jQuery?window.jQuery.FE:null)||window.FroalaEditor;for(let c in p)q.DEFAULTS[c]=p[c];q.PLUGINS.wordCounter=function(c){function t(a){var d;a=a.split(/(\[quote[^\]]*\]|\[\/quote\])/i);for(var b="",h=0,e=0;e<a.length;e++){var g=a[e];0===e%2?0===h&&(b=b+g.replace(/\s+$/,"")+"\n"):"/"===g[1]?h&&h--:h++}b=b.replace("[*]","");b=b.replace(/\[(attach|media|img|spoiler|ispoiler)[^]\]*?].*?\[\/\1\]/i,
"");a=b.split(/(\[[a-z0-9_]+(?:=[^\]]*){0,1}?\]|\[[a-z0-9_]+(?:\s?[a-z0-9_]+="[^"]*")+\]|\[\/[a-z0-9_]+\])/i);if(2>a.length)return b;b={};h={};for(e=1;e<a.length;e+=2)if(d=a[e].match(/^\[\/([a-z0-9_]+)\]/i))g=d[1].toLowerCase(),b[g]||(b[g]=[]),b[g].push(e);let f="";for(e=0;e<a.length;e++)if(g=a[e],0===e%2)f+=g;else if(!(e in h)){if(d=g.match(/^\[([a-z0-9_]+)(?:=|\s?[a-z0-9_]+="[^"]*"|\])/i))if(d=d[1].toLowerCase(),b[d]){let n;do n=b[d].shift();while(b[d].length&&n<e);if(n){h[n]=!0;continue}}f+=g}return f}
function r(){var a=c.opts.wordCounterGetText?c.opts.wordCounterGetText():c.el.innerText||"";c.opts.wordCounterBbCode&&(a=t(a),a=a.replace(/\{(slide)(?:=){0,1}?([^\|}]*)([^\}]*)\}(.*)\{\/slide\}/i,"[\\1] \\2"),a=a.replace(/\{(td|tr|th|thead|tbody|tfoot|colgroup|col|caption)(?:=){0,1}?(?:[^\}]*)\}(.*)\{\/\\1\}/i,"\\2 "));l?(a=a.split(l),a=a.filter(function(d){return 0!==d.length})):(a=a.replace(/\s+/gi," "),a=a.trim(),a=a.split(" "));return a.length}function u(){c.opts.wordCounter&&!m&&(m=setTimeout(function(){m=
null;var a=k;let d=r(),b,h,e=c.opts.wordCounterLabel,g=c.opts.wordCounterLabels,f=null;if("object"===typeof g&&Array.isArray(g)){for(h=0;h<g.length;h++)switch(b=g[h],b.operator){case "equals_to":b.word_count===d&&(f=b.label);break;case "not_equals_to":b.word_count!==d&&(f=b.label);break;case "greater_than":b.word_count<d&&(f=b.label);break;case "greater_than_or_equal_to":b.word_count<=d&&(f=b.label);break;case "lesser_than":b.word_count>d&&(f=b.label);break;case "lesser_than_or_equal_to":b.word_count>=
d&&(f=b.label)}null!==f&&(f=XF.stringTranslate(f,{"{word_count}":d}))}null===f&&(f=d+" "+e);a.innerHTML=f;c.opts.toolbarBottom&&(k.style.marginBottom=c.$tb.outerHeight(!0));a=c.$wp.get(0).offsetWidth-c.$wp.get(0).clientWidth;0<=a&&("rtl"===c.opts.direction?k.style.marginLeft=a:k.style.marginRight=a)},c.opts.wordCounterTimeout))}let k,m,l=null;return{_init:function(){if(c.opts.wordCounter&&c.$wp){try{l=RegExp("[^\\p{L}\\p{N}']+","u");var a=0;"unicode"in l&&l.unicode&&(a="1 1".split(l).length);2!==
a&&(l=null)}catch(d){l=null}k=document.createElement("span");k.classList.add("fr-word-counter");k.style.bottom=c.$wp.css("border-bottom-width");0>=c.opts.wordCounterTimeout&&(c.opts.wordCounterTimeout=0);c.$box.after(k);a=u.bind(this);c.events.on("paste.afterCleanup",a);c.events.on("contentChanged",a);c.events.on("charCounter.update",a);c.events.on("html.set",a);c.events.trigger("charCounter.update");c.events.on("destroy",function(){k.remove();k=null;m&&(clearTimeout(m),m=null)}.bind(this))}},count:r}}.bind(this)})();


var SV=window.SV||{};SV.AdvancedBBCode=SV.AdvancedBBCode||{};SV.WordCounter=SV.WordCounter||{};SV.AdvancedBBCode.EditorConfig=SV.AdvancedBBCode.EditorConfig||[];SV.$=SV.$||window.jQuery||null;
(function(){const d=SV.$;XF.Element.extend("textarea-handler",{__backup:{init:"svAdvancedBbCode_wordCounter_init"},svEditorField:null,svEditor:null,init:function(){this.svAdvancedBbCode_wordCounter_init();const b="function"!==typeof XF.on;if(!this.svEditor){var a=this.target||this.$target.get(0);let c=a.closest(".message-editorWrapper");c&&(this.svEditor=XF.getEditorInContainer(b?d(c):c));this.svEditor||(this.svEditor=(a=(a=a.closest(".bbWrapper"))?a.parentNode:null)?XF.getEditorInContainer(b?d(a):
a):null);if(!this.svEditor)return}this.svEditorField=this.target||this.$target.get(0);this.svEditor.ed.events.on("html.set",this.svOnHtmlSet.bind(this));b?(this.$target.on("autosize",this.svOnAutoSize.bind(this)),this.$target.on("input",this.svOnInput.bind(this))):(XF.on(this.target,"autosize",this.svOnAutoSize.bind(this)),XF.on(this.target,"input",this.svOnInput.bind(this)),setTimeout(this.svOnAutoSize.bind(this),0))},svPatchedWordCounterGetText:function(){return this.svEditorField.value},svOnHtmlSet:function(){this.svEditor.ed.opts.wordCounterGetText=
null},svOnAutoSize:function(){this.svEditorField.getAttribute("disabled")?this.svEditor.ed.opts.wordCounterGetText=null:(this.svEditor.ed.opts.wordCounterGetText||(this.svEditor.ed.opts.wordCounterGetText=this.svPatchedWordCounterGetText.bind(this)),this.svEditor.ed.events.trigger("charCounter.update"))},svOnInput:function(){this.svEditor.ed.opts.wordCounterGetText&&this.svEditor.ed.events.trigger("charCounter.update")}});SV.AdvancedBBCode.EditorConfig.push(function(b,a,c,e){b.wordCounter&&"undefined"!==
typeof e.DEFAULTS.wordCounter&&(a.wordCounter=!0,a.wordCounterBbCode=!0,a.wordCounterLabel=XF.phrase("sv_bbcode_word_count"),"svBbCodeWordCountPhrases"in XF.config&&(a.wordCounterLabels=XF.config.svBbCodeWordCountPhrases),a.wordCounterTimeout=SV.WordCounter.timeoutInterval||0,0>a.wordCounterTimeout&&(a.wordCounterTimeout=600),a.pluginsEnabled&&a.pluginsEnabled.push("wordCounter"))}.bind(this))})();


var SV=window.SV||{};SV.AdvancedBBCode=SV.AdvancedBBCode||{};SV.$=SV.$||window.jQuery||null;
(function(g,h,k){const d=SV.$,c="function"!==typeof XF.on;SV.AdvancedBBCode.PreviewClick=XF.Event.newHandler({eventType:"click",eventNameSpace:"SVAdvancedBBCodePreviewClick",options:{previewUrl:null,formTarget:"form",previewContainerTarget:".js-previewContainer"},form:null,initFailed:!0,isLoadingFromRequest:null,init:function(){this.options.previewUrl?this.options.formTarget?(this.form=(this.target||this.$target.get(0)).closest(this.options.formTarget))?this.isLoadingFromRequest=this.initFailed=!1:
console.error("No form available."):console.error("No form target provided."):console.error("No preview url provided.")},click:function(a){this.initFailed||this.isLoadingFromRequest||(this.isLoadingFromRequest=!0,a=XF.getDefaultFormData(c?d(this.form):this.form),a=XF.ajax("POST",this.options.previewUrl,a,this._handleResponseFromRequest.bind(this)),c?a.always(this.loadingFinished.bind(this)):a.finally(this.loadingFinished.bind(this)))},loadingFinished:function(){this.isLoadingFromRequest=!1},getPreviewContainer:function(){if(!this.options.previewContainerTarget)return console.error("No preview container target provided."),
null;var a=this.form.querySelector(this.options.previewContainerTarget);return a?a:(console.error("No preview container available."),null)},_handleResponseFromRequest:function(a){"html"in a&&(a.html.content?this._insertPreview(a.html):this._resetPreview())},_insertPreview:function(a){XF.setupHtmlInsert(a,function(b,e,f){if(e=this.getPreviewContainer())XF.activate(b),c?d(e).replaceWith(b):e.replaceChildren(...b.children),f(!0);return!1}.bind(this))},_resetPreview:function(){const a=this.getPreviewContainer();
if(a){var b=()=>{a.replaceChildren();XF.layoutChange()};c?d(a).xfFadeUp(XF.config.speed.fast,b):XF.Animate.fadeUp(a,{complete:b})}}});XF.Event.register("click","sv-advanced-bb-code-pack--preview-click","SV.AdvancedBBCode.PreviewClick")})(window,document);


var SV=window.SV||{};SV.AdvancedBBCode=SV.AdvancedBBCode||{};SV.AdvancedBBCode.EditorButtons=SV.AdvancedBBCode.EditorButtons||{};SV.AdvancedBBCode.EditorFirstStart=SV.AdvancedBBCode.EditorFirstStart||[];SV.$=SV.$||window.jQuery||null;
(function(F,B,G){function x(c,a,d){if(C)D(c).on(a,d);else XF.on(c,a,d)}const D=SV.$,C="function"!==typeof XF.on;SV.AdvancedBBCode.DialogForm=XF.Element.newHandler({options:{output:'[name="bb_code_output"]',bbCode:null,oldFormat:null,newLines:!0,asJson:!1,singleOption:!1},output:null,init:function(){if(this.options.bbCode){var c=this.target||this.$target.get(0);(this.output=c.querySelector(this.options.output))?(c.querySelectorAll("input[data-option-name], select[data-option-name], textarea[data-option-name]").forEach(a=>
{x(a,"keypress change paste input",this.generateOutput.bind(this))}),c.querySelectorAll("input[data-bb-value], select[data-bb-value], textarea[data-bb-value]").forEach(a=>{x(a,"keypress change paste input",this.generateOutput.bind(this))}),c.querySelectorAll('[data-xf-click="sv-advanced-bb-code-pack--preview-click"]').forEach(a=>{x(a,"click",this.generateOutput.bind(this))}),x(c,"submit",this.generateOutput.bind(this))):console.error("Missing output field.")}else console.error("Invalid bb code provided.")},
generateOutput:function(c){let a={},d=this.options.asJson,b=[],e=[],g=[],h="submit"===c.type;const n=this.target||this.$target.get(0);n.querySelectorAll('input[data-option-name]:not([type="submit"]), select[data-option-name], textarea[data-option-name]').forEach(f=>{if(!this.isElementHidden(f)||"hidden"===f.type)if(!this.options.output||!f.matches(this.options.output)){var k=f.getAttribute("name"),r=f.dataset.optionName,q=f.dataset.optionType||"string",u="true"===f.dataset.optionNameless;if(-1===
g.indexOf(k))if(g.push(k),r){if(k=this.valueFromInput(n,f,"option"))d?(k=this.getFormattedValue(q,k,f,!0),null!==k&&(a[r.replace("-","_")]=k)):b.push(this.optionStr(r,k,q,f,u,!1))}else console.error("Invalid option provided.")}});n.querySelectorAll('input[data-bb-value]:not([type="submit"]), select[data-bb-value], textarea[data-bb-value], input[data-value]:not([type="submit"]), select[data-value], textarea[data-value]').forEach(f=>{if(!this.isElementHidden(f)||"hidden"===f.type)if(!this.options.output||
!f.matches(this.options.output)){var k=f.getAttribute("name");if(this.getFormattedValue("bool",f.dataset.bbValue,f,!1)){var r=!0,q=f.closest(".formRow");q&&q.matches("[data-increment-format]")&&(XF.Element.getHandler(C?D(q):q,"field-adder").cloned||(r=!1));if(r){var u=this.getFormattedValue("bool",f.dataset.bbRequire,f,!1),v=f.dataset.bbRequireIfNot||null;r=this.getFormattedValue("str",f.dataset.bbRequirePhrase,f,!1)||null;q=f.dataset.bbType||"string";var y=this.valueFromInput(n,f,"bb_code");if(!y&&
h&&u){let A=f.getAttribute("id");A&&(u=this.getElementAsText(B,"label[for='"+A+"']"))&&(k=u);u=!0;let E="";"string"===typeof v&&(v=n.querySelector(v))&&(u=!this.getFormattedValue(this.valueFromInput(n,f,"bb_code"),"",null,!1))&&(E=v.getAttribute("name"),(A=v.getAttribute("id"))&&(v=this.getElementAsText(B,"label[for='"+A+"']"))&&(k=v));if(u){r||="please_enter_value_for_required_field_x";XF.overlayMessage(XF.phrase("oops_we_ran_into_some_problems"),XF.phrase(r,{"{field}":k,"{otherField}":E}));c.stopImmediatePropagation();
c.preventDefault();return}}if(y=this.valueStr(y,q,f,!1))d?(f=this.getFormattedValue(q,y,f,!0),null!==f&&(a.values||(a.values=[]),a.values.push(f))):e.push(y)}}}});var l=XF.htmlspecialchars(this.options.bbCode).toString().toUpperCase(),m=this.options.newLines?"<br/>\n":"",w="",p="";let t="",z=!1;if(d)w=JSON.stringify(a,null,2),z=!1,p="["+l+" json=1]"+m,t=m+"[/"+l+"]",w=p+w+t;else if(b.length||e.length){if(b.length){if(b=b.join(this.options.oldFormat?"|":" ").trim()){p=" ";if(this.options.oldFormat||
this.options.singleOption)p="=";b=p+b}}else b="";z=0===e.length;p="["+l+b+"]"+m;t=m+"[/"+l+"]";e.length?(e=e.join(m?m:" "),l=RegExp('<span data-caret-placeholder="true"></span>',"gi"),0!==(e.match(l)||[]).length&&(z=!0,m='<span id="'+Math.random().toString(36).substring(2,20)+'"></span>',l=e.replace('<span data-caret-placeholder="true"></span>',m).replace(l,"").split(m),e="",p+=l[0],t=l[1]+t)):e=m;w=p+e+t}else z=!0,p="["+l+"]"+m,t=m+"[/"+l+"]",w=p+t;this.output.dataset.bbCodeStart=p;this.output.dataset.bbCodeEnd=
t;this.output.dataset.bbCodeRespectCursor=z?"true":"false";this.output.value=w},isElementHidden:function(c){return!(c.offsetWidth||c.offsetHeight||c.getClientRects().length)},getElementAsText:function(c,a){return(c=c.querySelector(a))?c.textContent.trim():""},getElementValueAsText:function(c,a){return(c=c.querySelector(a))?(""+c.value).trim():""},valueFromInput:function(c,a,d){if(!d)return console.error("No input type provided."),null;var b=a.getAttribute("name");let e=null;var g=null;"option"===
d?(e=a.dataset.optionType,g=a.dataset.optionDelimiter):"bb_code"===d&&(e=a.dataset.bbType,g=a.dataset.bbDelimiter);e=e||"string";g=g||",";if("time"===e){if(d=this.getElementValueAsText(c,'[name="'+b+'[date]"]'),g=this.getElementValueAsText(c,'[name="'+b+'[time]"]'),b=this.getElementValueAsText(c,'[name="'+b+'[tz]"]'),""!==d)return(d+" "+g+" "+b).trim()}else{if(a.matches('[type="text"]')||a.matches("textarea")||a.matches('[type="number"]'))return a.value;if(a.matches('[type="radio"]')){if(c=c.querySelector('[name="'+
b+'"]:checked'))return b=b?c.closest("[data-value][data-name='"+b+"']"):null,this.getFormattedValue(e,c.value,b,!1)}else{if(a.matches('[type="checkbox"]')){let h=[];c.querySelectorAll('[name="'+b+'"]:checked').forEach(n=>{h.push(this.getFormattedValue(e,n.value,n,!1))});return h.join(g)}if(a.matches("select")){if(a.options&&a.multiple){let h=[];a.selectedOptions.forEach(n=>{h.push(this.getFormattedValue(e,n.value,a,!1))});return h.join(g)}return this.getFormattedValue(e,a.value,a,!1)}if(a.matches("input"))return this.getFormattedValue(e,
a.value,a,!1)}}return null},getFormattedValue:function(c,a,d,b){b=b||!1;a=(""+a).trim();var e=typeof a;let g=null;d&&(g=d.getAttribute("name"));switch(c){case "time":case "str":case "string":if(d&&d.dataset.value===a)return null;"string"!==e&&(a=String(a));break;case "bbCode":a=this.getFormattedValue("str",a,d,b).toString();b=!0;a=a.replaceAll("\n","<br>\n");break;case "int":case "number":case "seconds":if(d&&d.dataset.value===a)return null;"number"!==e&&(a=Number(a),isNaN(a)&&(a=0),"seconds"===c&&
(a+="s"));break;case "bool":case "boolean":if("boolean"!==e){switch(a){case "true":case "yes":case "on":case "1":a=!0;break;default:a=!1}b=!0}break;case "width":case "height":if(d){b=d.parentNode.querySelector('[name="'+g+'_unit"]');if(!b)return console.error("No unit input available for "+c+" input"),null;c=b.value;switch(c){case "px":case "pixels":c="px";break;case "%":case "percentage":c="%";break;case "auto":a="auto";c=null;break;default:c=a=null}null!==c?(a=this.getFormattedValue("int",a,null,
!1),null!==a&&(a=d&&b.dataset.value===c&&d.dataset.value===a?null:a.toString()+c)):"auto"===b.dataset.value&&(a=null);b=!0}break;case "slide":case "slide_header":c=(d.dataset.bbType||"").toUpperCase(),a=a?this.getFormattedValue("bbCode",a,d,!1):"",d=(b="old"===d.dataset.braceType)?"{":"[",b=b?"}":"]","SLIDE"===c&&(a+='<br/><span data-caret-placeholder="true"></span>'),e=this.options.newLines?"<br/>\n":"",a=d+c+b+e+a+e+d+"/"+c+b,b=!0}b||(a=XF.htmlspecialchars(a));return a},optionStr:function(c,a,d,
b,e,g){a=this.getFormattedValue(d||"string",a,b,g||!1);if(!a)return"";c=XF.htmlspecialchars(this.options.oldFormat?c:c.replace("-","_"));return this.options.oldFormat||this.options.singleOption?e||this.options.singleOption?'"'+a+'"':c+":"+a:c+'="'+a+'"'},valueStr:function(c,a,d,b){return(c=this.getFormattedValue(a||"string",c,d,b||!1))?c:""}});SV.AdvancedBBCode.EditorButtons.setupCommands=function(c,a){Array.isArray(c.dialog)&&c.dialog.forEach(function(d){SV.AdvancedBBCode[d]=SV.AdvancedBBCode[d]||
{};SV.AdvancedBBCode[d].editorButton||(SV.AdvancedBBCode[d].editorButton={init:function(){SV.AdvancedBBCode[d].EditorDialog=XF.extend(XF.EditorDialog,{simpleHtmlSnippet:null,cache:!1,container:null,_init:function(b){b=b.overlay||b.$overlay.get(0);const e=b.querySelector("div#bb_code_output_simple_html");this.simpleHtmlSnippet=e?e.innerHTML:null;null!==this.simpleHtmlSnippet?this.cache=!0:b.querySelectorAll("form").forEach(g=>{x(g,"submit",this.submit.bind(this))})},beforeShow:function(b,e){null!==
this.simpleHtmlSnippet?(e.cancelable=!0,e.preventDefault(),setTimeout(()=>{this.insertOutput(this.simpleHtmlSnippet)},0)):(this.overlay=b,this._beforeShow(b))},_beforeShow:function(b){this.ed.$el.blur()},_afterShow:function(b){const e=(b.container||b.$container.get(0)).querySelector("[data-bb-value]:not([data-no-fill])");if(e){b=this.ed;b.selection.restore();if(!b.selection.isCollapsed())if(e.dataset.bbValue){const g=b.html.getSelected();g&&XF.ajax("POST",XF.canonicalizeUrl("index.php?editor/to-bb-code"),
{html:g},function(h){e.value=h.bbCode})}else e.value=b.selection.text();b.selection.save();e.focus()}},submit:function(b){b.preventDefault();const e=(b=b.target.closest("form").querySelector('[name="bb_code_output"]'))?b.value:"",g="true"===b.dataset.bbCodeRespectCursor;e&&this.insertOutput(e,b,g);this.overlay.hide()},insertOutput:function(b,e=null,g=!1){const h=this.ed;h.selection.restore();h.undo.saveStep();g?(h.html.insert(e.dataset.bbCodeStart+'<div class="xf-froala-marker"></div>'+e.dataset.bbCodeEnd),
b=h.$el.find(".xf-froala-marker"),0!==b.length&&(h.selection.setAfter(b),b.remove(),h.selection.restore())):h.html.insert(b);h.placeholder.hide();h.undo.saveStep();XF.EditorHelpers.normalizeAfterInsert(h);h.events.trigger("charCounter.update")}})},callback:function(){XF.EditorHelpers.loadDialog(this,d)}});SV.AdvancedBBCode[d].editorButton.init();XF.EditorHelpers.dialogs[d]=new SV.AdvancedBBCode[d].EditorDialog(d);a.COMMANDS["xfCustom_"+d]&&(a.COMMANDS["xfCustom_"+d].callback=SV.AdvancedBBCode[d].editorButton.callback)})};
SV.AdvancedBBCode.EditorFirstStart.push(function(c,a){SV.AdvancedBBCode.EditorButtons.setupCommands(c,a)});XF.Element.register("svBbCode-dialog-form","SV.AdvancedBBCode.DialogForm")})(window,document);